@startuml

skinparam linetype ortho


' Entities

entity Users {
    * user_id : number <<generated>> 
    
    status : enum {active, suspended}
    
    first_name : string
    last_name : string
    phone_number : string
    
    email : string
    password_hash : string
    
    createdAt : datetime
    locale : enum {ru, en, kz}
}

entity Companies {
    * company_id : number <<generated>>
    
    status : enum {active, suspended} 
    
    name : string
    description : string
    logo_url : string
    location : string // or maybe city_id? 
    type : enum {supplier, consumer}
}

entity Employees {
    * company_id : number <<FK>>
    * user_id : number <<FK>>
    
    role : enum {Owner, Manager, Staff}
}

entity Products {
    * item_id : number <<generated>>
    * company_id : number <<FK>>
    
    name : string
    description : string
    picture_url : list<string>
    stock : number 
    
    retail_price : number
    threshold : number
    bulk_price : number
    
    minimum_order : number
    unit : string
    
    /'UNUSED'/
    /'avg_rating : number '/
}

entity ProductsImages {
    * image_id : number <<generated>>
    * item_id : number <<FK>>
    image_url : string
}

entity Linkings {
    * consumer_company_id : number <<FK>>
    * supplier_company_id : number <<FK>>
    
    * responsible_salesman_id : number <<FK>> /'first to accept'/
    
    status : enum {accepted, pending, rejected, unlinked}
    message : string /'optional'/
    createdAt : datetime
    updatedAt : datetime
}

entity Orders {
    * order_id : number <<generated>>

    consumer_company_id : number <<FK>>
    consumer_staff_id : number <<FK>> 
    
    supplier_company_id : number <<FK>>
    linking_id : number <<FK>>
    
    total_price : number
    
    status : enum {created, processing, shipping, completed}
} 

entity OrderProducts {
    * order_id : number <<FK>>
    * product_id : number <<FK>>
    product_quantity : number
    product_price : number
}

entity Chats {
    * chat_id : number <<generated>>
    * consumer_staff_id : number <<FK>>
    * linking_id : number <<FK>>
    
    createdAt : datetime
}

entity Messages {
    * message_id : number <<generated>>
    * chat_id : number <<FK>>
    * sender_id : number <<FK>>
    type : enum {text, audio, image, file}
    body : string /'text if type=text, url otherwise'/
}
    
' Relations

Companies ||--|{ Employees
Users ||--|| Employees

Companies ||--o{ Products
Products ||--|{ ProductsImages

Companies }o--|| Linkings
Companies }o--|| Linkings

Orders ||--|{ OrderProducts
Products ||--o| OrderProducts

Linkings ||--o{ Chats
Chats ||--o{ Messages


@enduml
